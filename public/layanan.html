<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Survey Kepuasan Layanan - MAN Kota Batu</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link 
    rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" 
  />
</head>
<body class="font-sans bg-white text-gray-900">
<!-- header and navbar -->
<header class="bg-blue-900 text-white shadow">
  <div class="container mx-auto flex justify-between items-center px-4 py-4 md:py-3">
    <!-- Logo di kiri -->
    <div class="flex items-center gap-3">
      <img src="img/logo man.png" alt="Logo" class="w-12 h-12" />
      <h1 class="text-lg font-bold">MAN KOTA BATU</h1>
    </div>

    <!-- Hamburger di kanan (mobile) -->
    <button id="nav-toggle" class="md:hidden p-2 rounded bg-blue-800">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Nav + Search (desktop) -->
    <div id="nav-menu" class="hidden md:flex md:items-center md:gap-6">
      <nav class="space-x-4 hidden md:block">
        <a href="home.html" class="hover:text-yellow-400">Home</a>
        <a href="profil.html" class="hover:text-yellow-400">Profil</a>
        <a href="prestasi.html" class="hover:text-yellow-400">Prestasi</a>
        <a href="pengumuman.html" class="hover:text-yellow-400">Pengumuman</a>
        <a href="layanan.html" class="text-yellow-400 font-bold">Layanan</a>
      </nav>
      <form id="searchForm" class="hidden md:flex items-center gap-2" onsubmit="return false;">
        <input id="searchInput" type="text" placeholder="Pencarian..." class="border rounded px-2 py-1 text-sm text-black" aria-label="Pencarian situs">
        <button type="submit" class="bg-yellow-400 text-blue-900 px-2 py-1 rounded">Cari</button>
      </form>
    </div>
  </div>

  <!-- Mobile menu (hidden by default) -->
  <div id="mobile-menu" class="md:hidden hidden bg-blue-800">
    <div class="flex flex-col px-6 py-4 space-y-3">
      <a href="home.html" class="block text-white py-2 hover:bg-blue-700 rounded">Home</a>
      <a href="profil.html" class="block text-white py-2 hover:bg-blue-700 rounded">Profil</a>
      <a href="prestasi.html" class="block text-white py-2 hover:bg-blue-700 rounded">Prestasi</a>
      <a href="pengumuman.html" class="block text-white py-2 hover:bg-blue-700 rounded">Pengumuman</a>
      <a href="layanan.html" class="block text-white py-2 hover:bg-blue-700 rounded">Layanan</a>
      <form id="searchFormMobile" class="flex items-center gap-2 mt-2" onsubmit="return false;">
        <input id="searchInputMobile" type="text" placeholder="Pencarian..." class="border rounded px-2 py-1 text-sm text-black" aria-label="Pencarian mobile">
        <button type="submit" class="bg-yellow-400 text-blue-900 px-2 py-1 rounded">Cari</button>
      </form>
    </div>
  </div>
</header>
  

  <!-- Bagian Judul -->
  <section class="text-center py-8 px-4">
    <h2 class="text-2xl md:text-3xl font-bold text-blue-900 mb-2">
      Survey Kepuasan layanan Kami
    </h2>
    <p class="text-gray-700 max-w-3xl mx-auto leading-relaxed">
      Untuk Memberi Pelayanan Terbaik Dari Buah Tinta Setiapnya Puas Bapak Ibu Dan
      Segenap Warga Survey Ini, Serta Masukan Bapak Ibu Kami Untuk Meningkatkan
      Kualitas Layanan Demi Kenyamanan Anda, Sampaikan Data Dan Penilaian
      Sangat Bantu Kami Agar Kami Bisa Maksimal Untuk Kedepanya.
    </p>
  </section>

<!-- Grid Pertanyaan -->
<section class="px-6 md:px-16 lg:px-28 pb-10">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

    <!-- Kartu 1 -->
    <div class="bg-blue-100 rounded-lg p-4 text-center flex flex-col justify-between h-full">
      <h3 class="text-gray-800 font-semibold mb-2">
        Bagaimana Layanan PTSP Yang Anda Dapatkan
      </h3>
      <div class="bg-blue-900 text-white py-6 rounded-lg">
        <p class="text-4xl font-bold">4.5/5</p>
        <p class="text-sm">(6 responden)</p>
      </div>
    </div>

    <!-- Kartu 2 -->
    <div class="bg-blue-100 rounded-lg p-4 text-center flex flex-col justify-between h-full">
      <h3 class="text-gray-800 font-semibold mb-2">
        Bagaimana dengan performa petugas dalam melayani kebutuhan Anda?
      </h3>
      <div class="bg-blue-900 text-white py-6 rounded-lg">
        <p class="text-4xl font-bold">4.8/5</p>
        <p class="text-sm">(6 responden)</p>
      </div>
    </div>

    <!-- Kartu 3 -->
    <div class="bg-blue-100 rounded-lg p-4 text-center flex flex-col justify-between h-full">
      <h3 class="text-gray-800 font-semibold mb-2">
        Seberapa Cepat Layanan Yang Kami Berikan?
      </h3>
      <div class="bg-blue-900 text-white py-6 rounded-lg">
        <p class="text-4xl font-bold">3.2/5</p>
        <p class="text-sm">(6 responden)</p>
      </div>
    </div>

    <!-- Kartu 4 dibagi dua: Ya & Tidak -->
    <div class="bg-blue-100 rounded-lg p-4 text-center flex flex-col justify-between h-full">
      <h3 class="text-gray-800 font-semibold mb-2">
        Apakah Ada Biaya Saat Mendapatkan Layanan Dari Kami?
      </h3>
      <div class="flex gap-4 justify-center">
        <!-- Ya -->
        <div class="bg-blue-900 text-white py-6 rounded-lg w-1/2 flex flex-col justify-center">
          <p class="text-3xl font-bold text-green-300">Ya</p>
          <p class="text-sm">(3 responden)</p>
        </div>
        <!-- Tidak -->
        <div class="bg-blue-900 text-white py-6 rounded-lg w-1/2 flex flex-col justify-center">
          <p class="text-3xl font-bold text-red-400">Tidak</p>
          <p class="text-sm">(3 responden)</p>
        </div>
      </div>
    </div>

  </div>

  <!-- Tombol di tengah -->
  <div class="w-full flex justify-center mt-8">
    <a href="survei.html"
       class="bg-blue-900 hover:bg-blue-800 text-white font-semibold px-6 py-2 rounded-lg transition transform hover:-translate-y-1 hover:shadow-lg">
      Mulai Survey Layanan
    </a>
  </div>
</section>
  
<!-- Footer -->
<footer class="bg-blue-900 text-white">
  <div class="container mx-auto px-6 py-12 grid grid-cols-1 md:grid-cols-3 gap-10">

    <!-- Kolom Kiri -->
    <div class="flex flex-col">
      <h2 class="text-xl font-bold border-b-2 border-yellow-400 pb-2 mb-3">
        MADRASAH ALIYAH NEGERI KOTA BATU
      </h2>
      <p class="text-gray-300 mb-4 text-sm">
        Jl. Patimura No.25, Temas, Kec. Batu, Kota Batu, Jawa Timur 65315
      </p>
      <ul class="space-y-3 text-sm">
        <li>
          <a href="tel:+62341592185" class="flex items-center gap-2 hover:text-yellow-400">
            <i class="fa-solid fa-phone bg-yellow-400 text-blue-900 w-6 h-6 flex items-center justify-center rounded"></i>
            (0341) 592185
          </a>
        </li>
        <li>
          <a href="https://www.instagram.com/mankotabatuofficial" target="_blank" class="flex items-center gap-2 hover:text-yellow-400">
            <i class="fa-brands fa-instagram bg-yellow-400 text-blue-900 w-6 h-6 flex items-center justify-center rounded"></i>
            Instagram
          </a>
        </li>
        <li>
          <a href="https://www.facebook.com/mankotabatuofficial" target="_blank" class="flex items-center gap-2 hover:text-yellow-400">
            <i class="fa-brands fa-facebook bg-yellow-400 text-blue-900 w-6 h-6 flex items-center justify-center rounded"></i>
            Facebook
          </a>
        </li>
        <li>
          <a href="https://www.tiktok.com/@mankotabatuofficial" target="_blank" class="flex items-center gap-2 hover:text-yellow-400">
            <i class="fa-brands fa-tiktok bg-yellow-400 text-blue-900 w-6 h-6 flex items-center justify-center rounded"></i>
            TikTok
          </a>
        </li>
        <li>
          <a href="https://x.com/mankotabatu" target="_blank" class="flex items-center gap-2 hover:text-yellow-400">
            <i class="fa-brands fa-x bg-yellow-400 text-blue-900 w-6 h-6 flex items-center justify-center rounded"></i>
            X / Twitter
          </a>
        </li>
        <li>
          <a href="https://www.linkedin.com/company/man-kota-batu/" target="_blank" class="flex items-center gap-2 hover:text-yellow-400">
            <i class="fa-brands fa-linkedin bg-yellow-400 text-blue-900 w-6 h-6 flex items-center justify-center rounded"></i>
            LinkedIn
          </a>
        </li>
      </ul>
    </div>

    <!-- Kolom Tengah (Map) -->
    <div class="flex justify-center md:justify-center">
      <iframe
        src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d587.4862762195498!2d112.53729759328873!3d-7.882424800796341!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sid!2sid!4v1747055343918!5m2!1sid!2sid"
        class="w-full md:w-[340px] h-[250px] rounded-lg border-2 border-yellow-400 shadow-lg"
        allowfullscreen
        loading="lazy"
        aria-label="Peta lokasi MAN Kota Batu"
      ></iframe>
    </div>

    <!-- Kolom Kanan -->
    <div class="flex flex-col">
      <h3 class="text-yellow-400 text-lg font-bold mb-3">TAUTAN PENTING</h3>
      <div class="mb-5">
        <h4 class="font-semibold">GURU</h4>
        <ul class="text-sm space-y-2 mt-2">
          <li><a href="https://rdm.mankotabatu.sch.id/" class="hover:text-yellow-400">Raport Digital Madrasah (RDM)</a></li>
          <li><a href="https://emisgtk.kemenag.go.id/" class="hover:text-yellow-400">EMIS GTK</a></li>
          <li><a href="#" class="hover:text-yellow-400">Absensi</a></li>
        </ul>
      </div>
      <!-- Garis pemisah -->
<div class="border-t-2 border-yellow-400 w-full my-6"></div>

      <div>
        <h4 class="font-semibold">SISWA</h4>
        <ul class="text-sm space-y-2 mt-2">
          <li><a href="https://uam.mankotabatu.sch.id/" class="hover:text-yellow-400">Computer Based Test (CBT)</a></li>
          <li><a href="#" class="hover:text-yellow-400">Absensi</a></li>
          <li><a href="#" class="hover:text-yellow-400">Ekstrakurikuler</a></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Bawah Footer -->
  <div class="bg-blue-950 text-center text-gray-300 text-sm py-4 mt-10 border-t border-gray-700">
    © 2025 Tikma. All rights reserved.
  <script>
  (function () {
    // Elemen rating (angka besar) dan elemen responden (teks kecil)
    const ratingEls = Array.from(
      document.querySelectorAll('section.px-6 .grid .bg-blue-900 .text-4xl')
    );
    const respondentEls = Array.from(
      document.querySelectorAll('section.px-6 .grid .bg-blue-900 .text-sm')
    );

    if (!respondentEls.length || !ratingEls.length) return;

    // Utility parse
    const parseIntFromText = (text) => {
      const n = parseInt((text || "").replace(/\D/g, ""), 10);
      return Number.isFinite(n) ? n : 0;
    };
    const parseRatingFromText = (text) => {
      // format "9/10" or "8.5/10"
      if (!text) return 0;
      const m = text.trim().split('/')[0];
      const v = parseFloat((m || "0").replace(/[^\d.]/g, ""));
      return Number.isFinite(v) ? v : 0;
    };

    // Ambil nilai awal dari DOM
    const initialCounts = respondentEls.map((el) => parseIntFromText(el.textContent));
    const initialTotals = ratingEls.map((el, i) => {
      // total = rating * count
      const avg = parseRatingFromText(el.textContent);
      return Math.round(avg * (initialCounts[i] || 0) * 10) / 10; // simpan satu desimal akurat
    });

    // Load / sinkron storage
    const KEY_COUNTS = "survey_counts";
    const KEY_TOTALS = "survey_totals";
    let counts, totals;

    try {
      const storedCounts = JSON.parse(localStorage.getItem(KEY_COUNTS) || "null");
      const storedTotals = JSON.parse(localStorage.getItem(KEY_TOTALS) || "null");
      if (Array.isArray(storedCounts) && storedCounts.length === initialCounts.length) {
        counts = storedCounts;
      } else {
        counts = initialCounts.slice();
        localStorage.setItem(KEY_COUNTS, JSON.stringify(counts));
      }
      if (Array.isArray(storedTotals) && storedTotals.length === initialTotals.length) {
        totals = storedTotals;
      } else {
        totals = initialTotals.slice();
        localStorage.setItem(KEY_TOTALS, JSON.stringify(totals));
      }
    } catch {
      counts = initialCounts.slice();
      totals = initialTotals.slice();
      localStorage.setItem(KEY_COUNTS, JSON.stringify(counts));
      localStorage.setItem(KEY_TOTALS, JSON.stringify(totals));
    }

    // Render ke DOM
    function formatAvg(avg) {
      if (!isFinite(avg)) return "0";
      if (Math.abs(avg - Math.round(avg)) < 1e-9) return String(Math.round(avg));
      return avg.toFixed(1);
    }
    function render() {
      respondentEls.forEach((el, i) => {
        el.textContent = `(${counts[i]} responden)`;
      });
      ratingEls.forEach((el, i) => {
        const c = counts[i] || 0;
        const avg = c ? totals[i] / c : 0;
        el.textContent = `${formatAvg(avg)}/5`;
      });
    }

    // Tambah responden & update totals.
    // scores: array of numbers (satu per kartu) yang mewakili skor baru dari 0..10.
    // Jika scores tidak diberikan, hanya tambahkan jumlah responden tanpa mengubah totals.
    function incrementAll(by = 1, scores = null) {
      if (!Array.isArray(counts) || !Array.isArray(totals)) return;
      if (scores && (!Array.isArray(scores) || scores.length !== counts.length)) {
        // jika scores tidak valid, abaikan scores
        scores = null;
      }

      for (let i = 0; i < counts.length; i++) {
        counts[i] = (counts[i] || 0) + by;
        if (scores) {
          const add = Number(scores[i]) || 0;
          totals[i] = (totals[i] || 0) + add * by;
        }
      }

      localStorage.setItem(KEY_COUNTS, JSON.stringify(counts));
      localStorage.setItem(KEY_TOTALS, JSON.stringify(totals));
      render();
    }

    // Expose API: survei.html dapat memanggil window.submitSurvey(scores) sebelum redirect
    // contoh: localStorage.setItem('survey_scores', JSON.stringify([9,10,8,10,10,10])); localStorage.setItem('survey_submitted','1'); window.location='layanan.html';
    window.incrementAllRespondents = incrementAll;
    window.submitSurveyAndRedirect = function(scores) {
      try {
        if (Array.isArray(scores)) {
          localStorage.setItem("survey_scores", JSON.stringify(scores));
        }
        localStorage.setItem("survey_submitted", "1");
      } catch {}
    };

    // Cek flag saat load: jika ada survey_submitted, tambahkan.
    function checkAndConsumeSubmittedFlag() {
      try {
        if (localStorage.getItem("survey_submitted")) {
          let scores = null;
          try {
            const s = JSON.parse(localStorage.getItem("survey_scores") || "null");
            if (Array.isArray(s) && s.length === counts.length) scores = s.map(Number);
          } catch {}
          incrementAll(1, scores);
          localStorage.removeItem("survey_submitted");
          localStorage.removeItem("survey_scores");
        }
      } catch {}
    }

    // Dengarkan perubahan storage (tab lain)
    window.addEventListener("storage", (e) => {
      try {
        if (e.key === "survey_submitted" && e.newValue) {
          // Jika ada flag dari tab lain: baca optional survey_scores lalu increment
          let scores = null;
          try {
            const s = JSON.parse(localStorage.getItem("survey_scores") || "null");
            if (Array.isArray(s) && s.length === counts.length) scores = s.map(Number);
          } catch {}
          incrementAll(1, scores);
          localStorage.removeItem("survey_submitted");
          localStorage.removeItem("survey_scores");
        }
        if (e.key === KEY_COUNTS && e.newValue) {
          const updated = JSON.parse(e.newValue);
          if (Array.isArray(updated) && updated.length === counts.length) {
            counts = updated;
            render();
          }
        }
        if (e.key === KEY_TOTALS && e.newValue) {
          const updated = JSON.parse(e.newValue);
          if (Array.isArray(updated) && updated.length === totals.length) {
            totals = updated;
            render();
          }
        }
      } catch {}
    });

    // Inisialisasi render & cek flag
    render();
    checkAndConsumeSubmittedFlag();
  })();
  </script>
</footer>
<!-- ✅ FIXED & OPTIMIZED: Mobile Nav + Search + Full-Word Highlight -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  // === HAMBURGER MENU (Mobile) ===
  const navToggle = document.getElementById("nav-toggle");
  const mobileMenu = document.getElementById("mobile-menu");

  if (navToggle && mobileMenu) {
    navToggle.addEventListener("click", () => {
      if (mobileMenu.classList.contains("hidden")) {
        mobileMenu.classList.remove("hidden", "animate-slideUp");
        mobileMenu.classList.add("animate-slideDown");
      } else {
        mobileMenu.classList.remove("animate-slideDown");
        mobileMenu.classList.add("animate-slideUp");
        setTimeout(() => mobileMenu.classList.add("hidden"), 300);
      }
    });

    // Tutup menu jika klik di luar area
    document.addEventListener("click", (e) => {
      if (!navToggle.contains(e.target) && !mobileMenu.contains(e.target)) {
        if (!mobileMenu.classList.contains("hidden")) {
          mobileMenu.classList.remove("animate-slideDown");
          mobileMenu.classList.add("animate-slideUp");
          setTimeout(() => mobileMenu.classList.add("hidden"), 300);
        }
      }
    });
  }

  // === HIGHLIGHT SELURUH KATA (Bukan potongan teks) ===
  function removeHighlights() {
    document.querySelectorAll(".search-highlight").forEach((span) => {
      const parent = span.parentNode;
      parent.replaceChild(document.createTextNode(span.textContent), span);
      parent.normalize();
    });
  }

  function highlightFullWord(term) {
    removeHighlights();
    if (!term) return;

    // regex untuk highlight seluruh kata yang mengandung term (contoh: "inst" → highlight "Instagram")
    const regex = new RegExp(`\\b[^\\s]*${term}[^\\s]*\\b`, "gi");

    const walker = document.createTreeWalker(
      document.body,
      NodeFilter.SHOW_TEXT,
      {
        acceptNode(node) {
          if (!node.parentElement) return NodeFilter.FILTER_REJECT;
          const tag = node.parentElement.tagName.toLowerCase();
          if (["script", "style", "input", "textarea", "button"].includes(tag))
            return NodeFilter.FILTER_REJECT;
          if (!node.nodeValue.trim()) return NodeFilter.FILTER_REJECT;
          return NodeFilter.FILTER_ACCEPT;
        },
      }
    );

    const nodes = [];
    while (walker.nextNode()) nodes.push(walker.currentNode);

    let firstHighlight = null;

    nodes.forEach((node) => {
      const text = node.nodeValue;
      if (regex.test(text)) {
        const replaced = text.replace(
          regex,
          (match) =>
            `<span class="search-highlight bg-yellow-300 text-blue-900 font-bold px-1 rounded">${match}</span>`
        );
        const span = document.createElement("span");
        span.innerHTML = replaced;
        node.replaceWith(...span.childNodes);

        if (!firstHighlight) {
          firstHighlight = document.querySelector(".search-highlight");
        }
      }
    });

    // Scroll ke hasil pertama
    if (firstHighlight) {
      firstHighlight.scrollIntoView({ behavior: "smooth", block: "center" });
    }
  }

  // === FORM HANDLING (Desktop + Mobile) ===
  const searchInput = document.getElementById("searchInput");
  const searchInputMobile = document.getElementById("searchInputMobile");

  document.getElementById("searchForm")?.addEventListener("submit", (e) => {
    e.preventDefault();
    highlightFullWord(searchInput.value.trim());
  });

  document.getElementById("searchFormMobile")?.addEventListener("submit", (e) => {
    e.preventDefault();
    highlightFullWord(searchInputMobile.value.trim());
    mobileMenu.classList.add("hidden");
  });

  [searchInput, searchInputMobile].forEach((el) => {
    if (!el) return;
    el.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        highlightFullWord(el.value.trim());
      }
    });
  });
});

// === ANIMASI SLIDE (Tailwind Extend) ===
tailwind.config = {
  theme: {
    extend: {
      keyframes: {
        slideDown: {
          "0%": { opacity: "0", transform: "translateY(-10px)" },
          "100%": { opacity: "1", transform: "translateY(0)" },
        },
        slideUp: {
          "0%": { opacity: "1", transform: "translateY(0)" },
          "100%": { opacity: "0", transform: "translateY(-10px)" },
        },
      },
      animation: {
        slideDown: "slideDown 0.3s ease-out forwards",
        slideUp: "slideUp 0.3s ease-in forwards",
      },
    },
  },
};
</script>
</html>



